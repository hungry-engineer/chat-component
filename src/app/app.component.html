<!-- https://bootsnipp.com/user/snippets/92nm6 
col-xs-5 col-md-3
-->
<div id="chat21-container">
    <div id="chat21-launcher-button" class="" (click)="f21_open()"></div>
    <div *ngIf="isShowed" id="chat21-conversations" class="chat21-window chat21-sheet">
        <!--HEADER-->
        <div class="chat21-sheet-header"> 
            <div class="chat21-sheet-header-title-container">
                <b class="chat21-sheet-header-title">Chat21
                        {{countChange}} {{test1}}
                </b>
            </div>
            <a class="chat21-sheet-header-close-button" (click)="f21_close()">
                <div class="chat21-sheet-header-button-icon-white"></div>
            </a>
        </div>

        <!--CONTENT-->
        <div class="chat21-sheet-content">
            <div class="chat21-spinner" id="chat21-loader">
                <div class="chat21-bounce-1"></div>
                <div class="chat21-bounce-2"></div>
                <div class="chat21-bounce-3"></div>
            </div>         
            <div class="chat21-conversation-parts-container">
                    <div id="scrollMe">
                            <!-- [scrollTop]="scrollMe.scrollHeight" [ngClass]="panelBodyOpen ? 'panelShown' : 'panelHidden'" -->
                    <div *ngFor="let message of messages">
                        
                        <div class="msg_container base_sent" *ngIf="message.sender == senderId;" >
                            <div class="messages msg_sent">
                                <p *ngIf="message.type == 'text';" class="message-contentX message-content-textX" [innerHTML]="message.text"></p>
                                <img *ngIf="message.type == 'image';" class="message-contentX message-content-imageX" [src]="message.metadata.src" [width]="getSizeImg(message).width" [height]="getSizeImg(message).height" />
                                <!-- <p  *ngIf="message.type == 'text';" [innerHTML]="message.text"></p>
                                <img *ngIf="message.type == 'image';" [src]="message.text" width="230" [height]="getHeightImg(message.metadata)"  /> -->
                            </div>
                            <div class="status-message">
                                <!-- {{message.status}} -->
                                <div *ngIf="!message.status" class="icon f21ico-schedule"></div>
                                <div *ngIf="message.status == MSG_STATUS_SENT" class="icon f21ico-done"></div>
                                <div *ngIf="message.status == MSG_STATUS_SENT_SERVER" class="icon f21ico-done"></div>
                                <div *ngIf="message.status == MSG_STATUS_RETURN_RECEIPT" class="icon f21ico-done_all"></div>     
                            </div>
                        </div>


                        <div *ngIf="message.sender != senderId;" class="message_sender_fullname">{{message.sender_fullname}}</div>
                        <div class="msg_container base_receive" *ngIf="message.sender != senderId;">  
                            <div class="content-avatar">
                                <!-- <img src="https://icon-icons.com/icons2/587/PNG/512/support_icon-icons.com_55294.png" class="img_circle" width="25" height="25"> -->
                                <div class = "profile_image"><img src = "{{getUrlImgProfile(message.sender)}}" onError="this.src='assets/images/f21ico-support.png';"/> </div>
                                <!-- <img src="{{getUrlImgProfile(message.sender)}}" class="img_circle" width="25" height="25"  > -->
                            </div>
                            
                            <div class="messages msg_receive">
                                <p *ngIf="message.type == 'text';" class="message-contentX message-content-textX" [innerHTML]="message.text"></p>
                                <img *ngIf="message.type == 'image';"  class="message-contentX message-content-imageX" [src]="message.metadata.src"  [width]="getSizeImg(message).width" [height]="getSizeImg(message).height" />
                                <!-- <p  *ngIf="message.type == 'text';" [innerHTML]="message.text"></p>
                                <img *ngIf="message.type == 'image';" [src]="message.text" width="230" [height]="getHeightImg(message.metadata)" /> -->
                            </div>
                        </div>

                        <div class="time" [ngClass]="{'sender' : message.sender == senderId}" >
                            <time>{{message.timestamp | amTimeAgo}}</time>
                        </div>

                    </div>
                    <span>&nbsp;</span>
                </div>
            </div>
        </div>

       <div id="chat21-footer">
            <div *ngIf="isConversationOpen == false" class="chat21b-box-new-conversation" (click)="startNwConversation()">
                INIZIA UNA NUOVA CONVERSAZIONE
            </div>
            <div *ngIf="isConversationOpen == true">
                <textarea #textbox rows="1" id="chat21-main-message-context" class='f21textarea' [(ngModel)]="textInputTextArea" [ngStyle]= myStyles (ngModelChange)="resizeInputField()"  (keypress)="onkeypress($event)"  placeholder="Scrivi la tua domanda..." ></textarea>
                <label for="chat21-file" [class.active]="!isSelected" class="chat21-textarea-button" id="chat21-start-upload-img" ></label>
                <label for="chat21-file" [class.active]="!isSelected" class="chat21-textarea-button" id="chat21-start-upload-doc" ></label>
            
                <div [class.active]="isSelected" class="chat21-textarea-button" id="chat21-button-reset" (click)="resetLoadImage()" ></div>
                <div [class.active]="isSelected" class="chat21-textarea-button" id="chat21-button-send" (click)="loadImage()"></div>
                <input style='display:none' type="file" accept="image/x-png,image/gif,image/jpeg" name="chat21-file" id="chat21-file" class="inputfile" (change)="detectFiles($event)"/>
                <!-- <input style='display:none' type="file" accept=".xlsx,.xls,image/*,.doc,.docx,.ppt,.pptx,.txt,.pdf" name="file" id="file" class="inputfile" (change)="detectFiles($event)"/> -->
                
                <!-- <img src="" width="200" alt="Image preview..."> -->
                <div [class.active]="isSelected" class="name-image" >{{nameImg}}</div>
            </div> 
            <div id="chat21-powered-by" >
                <!-- (click)="openRate()" -->
                <a target="_blank" href="http://www.chat21.org/">Offerto da <b>Chat21</b></a>
            </div>
       </div>

        
        <!-- Modale Filtri Markers -->
        <div class="modal-page-filter" [class.active]="isWidgetActive">
            <app-star-rating-widget></app-star-rating-widget>
        </div>
    </div>
</div>