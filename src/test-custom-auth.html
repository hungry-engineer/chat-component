<!DOCTYPE html>
<html>
  <head>
    <base href="./">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="application/javascript"> 
      // Handler for .ready() called.
      window.tiledeskSettings = 
      {
          projectid: "5b55e806c93dde00143163dd", //"5e8d7db806a5e200178e2df5", , //"5e8b398fef981300175e610e ", //
          persistence:"local",                /** local/session/none **/
          // userEmail: "czone555@gmail.com",
          // userPassword:"123456",
          // userToken: 'eyJhbGciOiJSUzI1NiIsImtpZCI6Ijk4MGVkMGQ3ODY2ODk1Y2E0M2MyMGRhZmM4NTlmMThjNjcwMWU3OTYiLCJ0eXAiOiJKV1QifQ.eyJwcm92aWRlcl9pZCI6ImFub255bW91cyIsImlzcyI6Imh0dHBzOi8vc2VjdXJldG9rZW4uZ29vZ2xlLmNvbS9jaGF0LXYyLWRldiIsImF1ZCI6ImNoYXQtdjItZGV2IiwiYXV0aF90aW1lIjoxNTYxMDIwNTg2LCJ1c2VyX2lkIjoicllXQmgwd2c2TE05U1drT2lMY0tySmdWVldkMiIsInN1YiI6InJZV0JoMHdnNkxNOVNXa09pTGNLckpnVlZXZDIiLCJpYXQiOjE1NjEwMjA1ODYsImV4cCI6MTU2MTAyNDE4NiwiZmlyZWJhc2UiOnsiaWRlbnRpdGllcyI6e30sInNpZ25faW5fcHJvdmlkZXIiOiJhbm9ueW1vdXMifX0.SID7kHLV0v5t0fd18WtlX_HfZ2nU2Qg6GU3HB2nNx9J7yaQQdZv1zkvXMmtJGIMCXw1Z_HMVDkbjqPOGOS-Wz8AF_Vdrxj2ePX6K6amE_DfZz2ECG-VrOghOPjggYwMCykmJu6k2IOHc3Z1jq9rTqCanHqmElUXTwDwUIub4OQ_fn6Ak1krotdNNUbdoFFDiPKt_39UC92Z3jbUf-2FQgxOWSJg7h8pjShe6anEFtdmjX50hl0dtbKhMNNacWtczAtRBrr1u7QCL0D8K-dzzxuduQUEMlnGPzYyQtaYfAxjWRQ8PP1BUBPeTNLiYtj4oprcCUS61qr3lBdw6tumtMw',
          // userId: "5b55e806c93dde00143163df", 
          isLogEnabled: false,                     /** true/false **/
          // preChatForm: false,
          calloutTimer:"0",
          // calloutTitle:"calloutTitle",
          // calloutMsg:"calloutMsg",
          // themeColor:"#cccccc",
          // themeForegroundColor:"#000000",
          // logoChat:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Coca-Cola_logo.svg/1280px-Coca-Cola_logo.svg.png",                  /** none/tiledesklogo/absolute url **/
          // welcomeTitle:"welcomeTitle",            /** string **/
          // welcomeMsg:"welcomeMsg",                /** string **/
          align: "right",                             /** left/right **/
          
          // development: true, // da verificare in tiledesk.js
          // tenant: "tilechat2",
          // recipientId: "support-group-Lhug32g57j5xyB7IgT4",
          
          // widgetTitle: "widget Title Test",
          // poweredBy: "poweredBy",
          // userEmail: "czone555@gmail.com",
          // userPassword: "123456",
          // userFullname: "Dario",
          // isOpen: true,                             /** true/false **/
          // channelType: "group",                     /** group/direct **/
          // lang: "en",                               /** it/en **/
          // marginX: "40px",
          // marginY: "40px",
          // fullscreenMode: true,
          // hideHeaderCloseButton: true,
          allowTranscriptDownload: true,
          // startFromHome: false,                       /** true/false **/
          // autoStart: false,                           /** true/false **/
          // isShown: false,                             /** true/false **/
          isLogoutEnabled: true,
          // filterByRequester: true,                  /** true/false **/
          // showWaitTime: false,                        /** true/false **/
          // showAvailableAgents: true,                 /** true/false **/
          // showLogoutOption: false,                    /** true/false **/
          // showWidgetNameInConversation: true,    
          // startMessage: {
          //   text: "hello",
          //   type: "text",
          //   attributes: {
          //     subtype: "info"
          //   },
          //   metadata: {}
          // },
          hideAttachButton: false
      };

      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); 
        js.id = id; //js.async=!0;
        js.src = "./launch.js"; //https://s3.eu-west-1.amazonaws.com/tiledesk-widget/dev/2.0.4-beta.1/
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'tiledesk-jssdk'));
      
      window.tileDeskAsyncInit = function() {
        
        window.tiledesk.on('loadParams', function(event_data) {
          console.log("test-custom-auth.html loadParams");
          setTimeout(function() {
            window.tiledesk.showCallout()
          }, 3000)
        });

  //       window.tiledesk.on('onNewConversation', function(event_data) {
  //         console.log("test-custom-auth.html onNewConversation",event_data);
  //         const tiledeskToken = window.tiledesk.angularcomponent.component.g.tiledeskToken;
  //         console.log("------------------->>>> tiledeskToken: ",tiledeskToken);
  //         if(tiledeskToken) {
  //           var httpRequest = createCORSRequest('POST', event_data.detail.appConfigs.apiUrl+event_data.detail.default_settings.projectid+'/events',false); //set async to false because loadParams must return when the get is complete
  //           httpRequest.setRequestHeader('Content-type', 'application/json');
  //           httpRequest.setRequestHeader('Authorization',tiledeskToken);
  //           httpRequest.send(JSON.stringify({"name":"new_conversation","attributes": {"id_user":event_data.detail.global.senderId, "request_id":event_data.detail.newConvId, "department": event_data.detail.global.departmentID, "subtype":"info", "fullname":event_data.detail.global.attributes.userFullname, "email":event_data.detail.global.attributes.userEmail, "attributes":event_data.detail.global.attributes}}));
  //         }
  //       });

  //       window.tiledesk.on('isLoggedIn', function(event_data) {
  //         console.log("test-custom-auth.html isLoggedIn",event_data);
  //         const tiledeskToken = window.tiledesk.angularcomponent.component.g.tiledeskToken;
  //         console.log("------------------->>>> tiledeskToken: ",tiledeskToken);
  //         if(tiledeskToken) {
  //           var httpRequest = createCORSRequest('POST', event_data.detail.appConfigs.apiUrl+event_data.detail.default_settings.projectid+'/events',false); //set async to false because loadParams must return when the get is complete
  //           httpRequest.setRequestHeader('Content-type', 'application/json');
  //           httpRequest.setRequestHeader('Authorization',tiledeskToken);
  //           httpRequest.send(JSON.stringify({"name":"log_in","attributes": {"id_user":event_data.detail.global.senderId, "fullname":event_data.detail.global.attributes.userFullname, "email":event_data.detail.global.attributes.userEmail, "attributes":event_data.detail.global.attributes}}));
  //         }
  //       });
        
      };
    </script>
  </head>
  <body>
      <p style="text-align: right"><a href="www.google.it">link</a></p>
  </body>
</html>